;; -*-lisp-*-
(in-package :stumpwm)

;; mondd meg az ASDF-nek, hogy hol keresse a contrib modulokat
(pushnew #P"~/.stumpwm.d/contrib/" asdf:*central-registry* :test #'equal)
(set-module-dir (pathname-as-directory (concat (getenv "HOME") "/.stumpwm.d/contrib")))

;;; load TTF
;;(ql:quickload :clx-truetype)
;;(load-module "ttf-fonts")
;;(xft:cache-fonts)
;;(set-font (make-instance 'xft:font :family "Source Code Pro" :subfamily "Bold" :size 7 :antialias t))

;; Prefix key átállítása (ha nem akarod a Ctrl+t-t)
(set-prefix-key (kbd "F13"))  ;

;;; billentyűk
(define-key *top-map* (kbd "s-Return") "exec alacritty")
(define-key *top-map* (kbd "s-d") "exec rofi -show run")
(define-key *top-map* (kbd "s-w") "exec firefox")
(define-key *top-map* (kbd "s-p") "exec discord")
(define-key *top-map* (kbd "s-P") "exec thunar")
(define-key *top-map* (kbd "s-E") "exec subl")

;; Konfig újratöltése
(define-key *top-map* (kbd "s-r") "reload")

;; Restart (újraindítás)
(define-key *top-map* (kbd "s-R") "restart-hard")

;; Ablak bezárása
(define-key *top-map* (kbd "s-q") "delete")
(define-key *top-map* (kbd "s-Q") "remove")
(define-key *root-map* (kbd "f") "fullscreen")

;; Ablakok közti váltás
(define-key *top-map* (kbd "s-Tab") "next")
(define-key *top-map* (kbd "M-Tab") "pull-hidden-next")

;; Ablak áthelyezése másik keretbe (tilingnél)
(define-key *top-map* (kbd "s-S-Right") "move-window right")
(define-key *top-map* (kbd "s-S-Left")  "move-window left")
(define-key *top-map* (kbd "s-S-Up")    "move-window up")
(define-key *top-map* (kbd "s-S-Down")  "move-window down")

;;; --- Osztás (split) ---

;; Commands
(defcommand fullscreen-and-raise () ()
"Fullscreen window and make sure it's on top of all other windows"
(with-on-top (stumpwm:current-window) (fullscreen)))


(defcommand hsplit-and-focus () ()
"create a new frame on the right and focus it."
(hsplit)
(move-focus :right))


(defcommand vsplit-and-focus () ()
"create a new frame below and focus it."
(vsplit)
(move-focus :down))


(defcommand remove-and-balance () ()
"Remove current split and balance the rest"
(remove-split)
(balance-frames))


(define-key *top-map* (kbd "s-v") "hsplit-and-focus")
(define-key *top-map* (kbd "s-h") "vsplit-and-focus")

;; Split bezárása
(define-key *top-map* (kbd "s-x") "only")

;;; workspace-ek (groupok)
(gnew "web")
(gnew "chat")
(gnew "dev")
(gselect "web")

;; A group-ok nevei
(defparameter *my-groups* '("web" "chat" "dev"))

;; Super + szám → váltás a group-ra
(loop for i from 1 to (length *my-groups*)
      for name = (nth (1- i) *my-groups*) do
      (define-key *top-map*
        (kbd (format nil "s-~a" i))
        (format nil "gselect ~a" name)))




(setf
 *mode-line-background-color* "#282a36";
 *mode-line-foreground-color* "#bbbbbb"
 *mode-line-border-color* "#282a36"
 *mode-line-border-width* 0
 *mode-line-timeout* 1
 *group-format* " %t "
 *time-modeline-string* "%H:%M"
 *window-format* "<%n:%25t>"
 *screen-mode-line-format* (list "%g  %v ^> " '(:eval  (string-trim '(#\Newline) (run-shell-command "sensors | grep Tctl | awk '{print $2}' | sed 's/+//g'" t))) " | " '(:eval  (string-trim '(#\Newline) (run-shell-command "sensors | awk '/edge:/ {print $2}'" t))) " | " '(:eval (string-trim '(#\Newline) (run-shell-command "$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq) | awk '{printf("%.2f GHz", $1/1000000)}'" t))) " |  %d")
)

(enable-mode-line (current-screen) (current-head) t)

;;; téma / színek
(set-fg-color "#ffffff")
(set-bg-color "#282a36")
(set-border-color "#282a36")



;;; Theme
(setf *colors*
      '("#000000"   ;black
        "#BF6262"   ;red
        "#a1bf78"   ;green
        "#dbb774"   ;yellow
        "#7D8FA3"   ;blue
        "#ff99ff"   ;magenta
        "#53cdbd"   ;cyan
        "#ffffff")) ;white

(update-color-map (current-screen))


;;; Basic Settings

(setf *message-window-gravity* :center
      *window-border-style* :thin
      *message-window-padding* 3
      *maxsize-border-width* 2
      *normal-border-width* 2
      *transient-border-width* 2
      stumpwm::*float-window-border* 1
      stumpwm::*float-window-title-height* 1)

;;; Gaps
(load-module "swm-gaps")
(setf swm-gaps:*inner-gaps-size* 13
      swm-gaps:*outer-gaps-size* 7
      swm-gaps:*head-gaps-size* 0)
(when *initializing*
  (swm-gaps:toggle-gaps))
(define-key *top-map* (kbd "s-g") "toggle-gaps")


;;;  end session module
(load-module "end-session")
(define-key *root-map* (kbd "Escape") "end-session")
